<!DOCTYPE html>
<html lang="en" style="background:#171717; color:#FFFFFF;">
<head>
  <!-- Pre-paint dark + JS nudge so first frame is #171717 -->
  <style>
    html, body { margin:0; padding:0; background:#171717; color:#FFFFFF; }
  </style>
  <script>
    // In case CSS is delayed by a tick on mobile
    document.documentElement.style.background = '#171717';
    try { document.body && (document.body.style.background = '#171717'); } catch(e){}
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Chrome/Android address bar color (helps during load on mobile) -->
  <meta name="theme-color" content="#171717" />
  <title>Lantern Player</title>

  <style>
    :root{
      --bg:#171717;      /* exact dark background */
      --text:#FFFFFF;    /* white for play icon + time */
      --muted:#8c8c8c;   /* time label */
      --wave:#8a8a8a;    /* unplayed waveform (mid-gray) */
      --prog:#3a3a3a;    /* played part darker for Disco-like style */

      --gutter:12px;
      --wave-h:96px;
    }

    html,body{
      background:var(--bg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      -webkit-font-smoothing:antialiased;
      overflow:hidden;
    }

    .wrap{
      width:100%;
      max-width:700px;
      margin:0 auto;
      padding:0 var(--gutter);
      box-sizing:border-box;
    }

    /* Waveform only — clean */
    #wave{
      width:100%; height:var(--wave-h);
      background:transparent;
      border-radius:12px; overflow:hidden;
    }

    /* Ensure no white flash from canvases WaveSurfer injects */
    #wave canvas,
    #wave .wavesurfer,
    #wave .wavesurfer * { background-color:#171717 !important; }

    .footerRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-top:12px;
    }

    .time{
      font-size:12px; color:var(--muted); letter-spacing:.2px; min-width:42px;
    }

    .controls{
      flex:1; display:flex; justify-content:center; align-items:center;
    }

    /* Play button — solid white ring & icon, static */
    .playbtn{
      width:64px; height:64px; border-radius:50%;
      background:var(--bg);
      border:2px solid #FFFFFF;
      display:grid; place-items:center; cursor:pointer; outline:none;
      -webkit-tap-highlight-color: transparent;
    }
    .playbtn svg{ width:24px; height:24px; fill:#FFFFFF; }
    .playbtn:focus, .playbtn:hover, .playbtn:active{
      border-color:#FFFFFF; background:var(--bg);
    }

    @media (max-width:360px){
      :root{ --wave-h:88px; }
      .playbtn{ width:58px; height:58px; }
      .playbtn svg{ width:22px; height:22px; }
    }
  </style>
</head>
<body style="background:#171717; color:#FFFFFF;">
  <div class="wrap">
    <div id="wave"></div>

    <div class="footerRow">
      <div id="tLeft" class="time">0:00</div>
      <div class="controls">
        <button id="toggle" class="playbtn" aria-label="Play / Pause">
          <svg viewBox="0 0 24 24" id="icon"><path d="M8 5v14l11-7z"/></svg>
        </button>
      </div>
      <div id="tRight" class="time">0:00</div>
    </div>
  </div>

  <audio id="media" preload="auto" playsinline></audio>
  <script src="https://unpkg.com/wavesurfer.js@7" defer></script>
  <script>
    const params = new URLSearchParams(location.search);
    const AUDIO_URL = params.get('audio') || './demo.mp3';

    const media = document.getElementById('media');
    media.src = AUDIO_URL;
    media.crossOrigin = 'anonymous';

    // Create WaveSurfer after script loads
    window.addEventListener('load', () => {
      const ws = WaveSurfer.create({
        container:'#wave',
        media,
        backend:'MediaElement',
        height: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--wave-h')),
        waveColor:getComputedStyle(document.documentElement).getPropertyValue('--wave').trim(),
        progressColor:getComputedStyle(document.documentElement).getPropertyValue('--prog').trim(),
        cursorColor:'rgba(255,255,255,.3)',
        barWidth:2,
        barGap:1,
        normalize:true,
        responsive:true,
        dragToSeek:true,
        fillParent:true
      });

      const fmt = s => (!isFinite(s)? '0:00' : `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`);
      const tLeft = document.getElementById('tLeft');
      const tRight = document.getElementById('tRight');
      let dur = 0;

      ws.on('ready', ()=>{
        dur = ws.getDuration() || media.duration || 0;
        tLeft.textContent = '0:00';
        tRight.textContent = fmt(dur);
      });

      ws.on('audioprocess', ()=>{ tLeft.textContent = fmt(ws.getCurrentTime()); });
      ws.on('seek', ()=>{ tLeft.textContent = fmt(ws.getCurrentTime()); });

      const btn = document.getElementById('toggle');
      const icon = document.getElementById('icon');
      function syncIcon(){
        icon.innerHTML = media.paused
          ? '<path d="M8 5v14l11-7z"/>'
          : '<path d="M6 5h4v14H6zm8 0h4v14h-4z"/>';
      }
      btn.onclick = ()=>{ ws.playPause(); syncIcon(); };
      media.addEventListener('play', syncIcon);
      media.addEventListener('pause', syncIcon);

      // Spacebar toggle (desktop)
      addEventListener('keydown', e => {
        if (e.code === 'Space') { e.preventDefault(); btn.click(); }
      });
    });
  </script>
</body>
</html>
