<!DOCTYPE html>
<html lang="en" style="background:#000000;color:#FFFFFF;">
<head>
  <style>
    html, body { 
      margin:0; 
      padding:0; 
      background:#171717; 
      color:#FFFFFF; 
    }
    
    #loader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #171717;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .loader-bars {
      display: flex;
      gap: 8px;
      align-items: flex-end;
      height: 40px;
    }
    .loader-bars span {
      width: 3px;
      background: #FFFFFF;
      border-radius: 2px;
      animation: pulse-bar 1.4s ease-in-out infinite;
    }
    .loader-bars span:nth-child(1) { animation-delay: 0s; height: 20px; }
    .loader-bars span:nth-child(2) { animation-delay: 0.2s; height: 32px; }
    .loader-bars span:nth-child(3) { animation-delay: 0.4s; height: 26px; }
    @keyframes pulse-bar {
      0%, 100% { transform: scaleY(0.4); opacity: 0.4; }
      50% { transform: scaleY(1); opacity: 1; }
    }
    
    #loader.hide { 
      opacity: 0; 
      pointer-events: none;
    }
  </style>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#171717" />
  <meta name="color-scheme" content="dark only" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Lantern Player</title>

  <link rel="preload" href="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js" as="script" />

  <script>
    (function () {
      try {
        const u = new URLSearchParams(location.search).get('audio');
        if (u) {
          const l = document.createElement('link');
          l.rel = 'preload'; l.as = 'audio'; l.href = u; l.crossOrigin = 'anonymous';
          document.head.appendChild(l);
        }
      } catch (e) {}
    })();
  </script>

  <style>
    :root{
      --bg:#171717;
      --muted:#8c8c8c;
      --wave-h:160px;
      --player-top-offset: 40px;
    }

    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
    }

    html,body{
      background:#171717;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow:hidden;
      color:#FFFFFF;
      font-weight: 400;
    }

    .wrap{
      width:100%;
      max-width:600px;
      margin:0 auto;
      padding:0 32px;
      opacity:0;
      transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      margin-top: var(--player-top-offset);
    }

    #wave{
      width:100%;
      height:var(--wave-h);
      background:transparent;
      border-radius:0;
      overflow:hidden;
      cursor:pointer;
      margin: 20px 0 24px 0;
    }
    #wave canvas { 
      background-color:transparent; 
      display:block; 
    }

    .controls{
      display:flex;
      justify-content:center;
      align-items:center;
      margin: 24px 0;
    }

    .playbtn{
      width:64px;
      height:64px;
      border-radius:50%;
      background:var(--bg);
      border:2px solid #FFFFFF;
      display:grid;
      place-items:center;
      cursor:pointer;
      outline:none;
      -webkit-tap-highlight-color: transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .playbtn svg{
      width:24px; 
      height:24px; 
      fill:#FFFFFF;
      transition: all 0.2s ease;
    }
    
    .playbtn:active{
      transform: scale(0.95);
      border-color:#FFFFFF;
      background:var(--bg);
    }

    .playbtn:active svg{
      fill:#FFFFFF;
    }

    .footerRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:12px;
      gap:10px;
    }

    .time{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.2px;
      min-width:42px;
    }

    @media (max-width:360px){
      :root{ --wave-h:120px; }
      .wrap{ padding: 0 24px; }
      .playbtn{ width:64px; height:64px; }
      .playbtn svg{ width:20px; height:20px; }
    }
  </style>
</head>
<body>
  <div id="loader">
    <div class="loader-bars">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div class="wrap">
    <div id="wave"></div>

    <div class="footerRow">
      <div id="tLeft" class="time">0:00</div>
      <div id="tRight" class="time">0:00</div>
    </div>

    <div class="controls" id="controls">
      <button id="toggle" class="playbtn" aria-label="Play / Pause">
        <svg viewBox="0 0 24 24" id="icon"><path d="M8 5v14l11-7z"/></svg>
      </button>
    </div>
  </div>

  <audio id="media" preload="auto" playsinline></audio>

  <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js"></script>
  <script>
    const params    = new URLSearchParams(location.search);
    const AUDIO_URL = params.get('audio') || 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';

    const media = document.getElementById('media');
    media.src = AUDIO_URL;
    media.crossOrigin = 'anonymous';

    const ws = WaveSurfer.create({
      container:'#wave',
      media,
      backend:'MediaElement',
      height: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--wave-h')),
      waveColor:'rgba(255,255,255,0.25)',
      progressColor:'rgba(255,255,255,0.85)',
      cursorColor:'rgba(255,255,255,0)',
      barWidth:2,
      barGap:2,
      barRadius:2,
      normalize:true,
      responsive:true,
      dragToSeek:true,
      fillParent:true
    });

    const fmt = s => (!isFinite(s)
      ? '0:00'
      : `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`);

    const tLeft  = document.getElementById('tLeft');
    const tRight = document.getElementById('tRight');
    const wrap = document.querySelector('.wrap');
    const footer = document.getElementById('footer');
    const controls = document.getElementById('controls');
    let dur = 0;

    ws.on('ready', ()=>{
      dur = ws.getDuration() || media.duration || 0;
      tLeft.textContent  = '0:00';
      tRight.textContent = fmt(dur);
      
      wrap.style.opacity = '1';
      document.getElementById('loader').classList.add('hide');
    });

    ws.on('audioprocess', ()=>{ 
      tLeft.textContent = fmt(ws.getCurrentTime()); 
    });
    
    ws.on('seek', ()=>{ 
      tLeft.textContent = fmt(ws.getCurrentTime()); 
    });

    // Make waveform clickable
    document.getElementById('wave').addEventListener('click', (e) => {
      // Don't trigger if clicking during drag
      if (!ws.isPlaying()) {
        ws.play();
        syncIcon();
      }
    });

    const btn  = document.getElementById('toggle');
    const icon = document.getElementById('icon');
    
    function syncIcon(){
      const isPlaying = !media.paused;
      icon.innerHTML = isPlaying
        ? '<path d="M6 5h4v14H6zm8 0h4v14h-4z"/>'
        : '<path d="M8 5v14l11-7z"/>';
    }
    
    btn.onclick = ()=>{ ws.playPause(); syncIcon(); };
    media.addEventListener('play',  syncIcon);
    media.addEventListener('pause', syncIcon);

    addEventListener('keydown', e => {
      if (e.code === 'Space') { e.preventDefault(); btn.click(); }
    });
  </script>
</body>
</html>
