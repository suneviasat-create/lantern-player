<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Instant dark paint -->
  <style>
    html, body { margin:0; padding:0; background:#171717; color:#fff; }
  </style>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#171717" />
  <title>Lantern Player â€” SoundCloud Style</title>

  <style>
    :root{
      --bg:#171717;
      --text:#FFFFFF;
      --muted:#8c8c8c;
    }

    html,body{
      background:var(--bg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      overflow:hidden;
    }

    .wrap{
      width:100%;
      max-width:700px;
      margin:0 auto;
      padding:20px 12px;
      box-sizing:border-box;
    }

    /* SoundCloud waveform container */
    #waveform {
      position: relative;
      cursor: pointer;
      height: 96px;
      border-radius: 8px;
      overflow: hidden;
    }

    /* Hover overlay (same as SoundCloud demo) */
    #hover {
      position: absolute;
      left: 0;
      top: 0;
      z-index: 10;
      pointer-events: none;
      height: 100%;
      width: 0;
      mix-blend-mode: overlay;
      background: rgba(255, 255, 255, 0.2);
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    #waveform:hover #hover { opacity: 1; }

    /* Time labels */
    #time, #duration {
      position: absolute;
      z-index: 11;
      bottom: -20px;
      font-size: 12px;
      color: var(--muted);
    }
    #time { left: 0; }
    #duration { right: 0; }

    /* Center play button (same Lantern style) */
    .controls{
      margin-top: 24px;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .playbtn{
      width:64px;
      height:64px;
      border-radius:50%;
      border:2px solid #fff;
      background:var(--bg);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .playbtn svg{ width:24px; height:24px; fill:#fff; }

    @media (max-width:360px){
      #waveform{height:88px;}
      .playbtn{width:58px;height:58px;}
      .playbtn svg{width:22px;height:22px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="waveform">
      <div id="time">0:00</div>
      <div id="duration">0:00</div>
      <div id="hover"></div>
    </div>

    <div class="controls">
      <button id="toggle" class="playbtn" aria-label="Play / Pause">
        <svg viewBox="0 0 24 24" id="icon"><path d="M8 5v14l11-7z"/></svg>
      </button>
    </div>
  </div>

  <audio id="media" preload="auto" playsinline></audio>

  <!-- CDN version (includes barAlign + gradients) -->
  <script src="https://unpkg.com/wavesurfer.js@7.11.0/dist/wavesurfer.min.js"></script>

  <script>
    const params = new URLSearchParams(location.search);
    const AUDIO_URL = params.get('audio') || './demo.mp3';
    const media = document.getElementById('media');
    media.src = AUDIO_URL;
    media.crossOrigin = 'anonymous';

    // Create offscreen canvas for gradient definitions
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    const makeGradient = (top, mid, white, bottom) => {
      const g = ctx.createLinearGradient(0, 0, 0, canvas.height * 1.35);
      g.addColorStop(0, top);
      g.addColorStop(0.7, mid);
      g.addColorStop(0.705, white);
      g.addColorStop(0.71, white);
      g.addColorStop(0.715, bottom);
      g.addColorStop(1, bottom);
      return g;
    };

    const waveGradient = makeGradient('#555','#666','#999','#777');
    const progGradient = makeGradient('#3a3a3a','#2f2f2f','#fff','#2a2a2a');

    const wavesurfer = WaveSurfer.create({
      container: '#waveform',
      media,
      backend: 'MediaElement',
      height: 96,
      waveColor: waveGradient,
      progressColor: progGradient,
      cursorColor: 'rgba(255,255,255,.3)',
      barWidth: 2,
      barGap: 1,
      barRadius: 2,
      barAlign: 'center',
      normalize: true,
      responsive: true,
      dragToSeek: true,
      fillParent: true,
    });

    // Hover width follow pointer
    const hover = document.querySelector('#hover');
    const waveform = document.querySelector('#waveform');
    waveform.addEventListener('pointermove', e => hover.style.width = `${e.offsetX}px`);

    // Time updates
    const formatTime = s => {
      const m = Math.floor(s/60);
      const sec = Math.round(s)%60;
      return `${m}:${String(sec).padStart(2,'0')}`;
    };
    const timeEl = document.querySelector('#time');
    const durEl = document.querySelector('#duration');
    wavesurfer.on('decode', d => durEl.textContent = formatTime(d));
    wavesurfer.on('timeupdate', c => timeEl.textContent = formatTime(c));

    // Play/pause logic
    const btn = document.getElementById('toggle');
    const icon = document.getElementById('icon');
    const syncIcon = () => {
      icon.innerHTML = media.paused
        ? '<path d="M8 5v14l11-7z"/>'
        : '<path d="M6 5h4v14H6zm8 0h4v14h-4z"/>';
    };
    btn.onclick = ()=>{ wavesurfer.playPause(); syncIcon(); };
    media.addEventListener('play', syncIcon);
    media.addEventListener('pause', syncIcon);
  </script>
</body>
</html>
